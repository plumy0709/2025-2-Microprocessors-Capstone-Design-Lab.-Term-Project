2025-2 마이크로프로세서 설계 실험 팀 프로젝트
작성자: 황동영 (경북대학교 전자공학부 F반, 2021114887) 

설계명: 다중 기능 멀티 인터페이스 시스템 

구상: GPIO, 타이머, 스위치 폴링 및 인터럽트, PWM, UART, 7 세그먼트 및 LCD를 이용하여 실제 환경에서 택시를 주행할 때 내부 택시 미터기를 설계한다. 

택시 미터기란: 
    실제 택시를 타고 목적지로 가는 동안을 가정하고, 움직인 거리, 사용한 연료에 비례하여 요금이 올라가는 방식이다. 
    이걸 구현하기 위해서는 여러 요구사항이 필요하다. 

요구사항: 
    1. 가속, 감속을 담당하는 입력이 필요하다.
    2. 실제 차량은 이동하면서 바퀴와 도로면 사이 마찰 때문에 속도가 점점 준다. 
        즉, 아무런 입력이 없을 때 서서히 속도가 줄어야 한다. 
    3. 운전은 다양한 부류의 사람들이 한다. 
        그 중 양발운전을 하는 사람이 있을 수도 있으므로 가속 + 감속 두 입력을 둘 다 주는 경우도 고려해야 한다. 
    4. 실제 공도에서는 신호등에 의해 교통 흐름이 제어된다. 
        이 때 노란불 -> 빨간불인 상황에서는 정지선에 멈춰야 하므로 정지를 해줘야 한다. 
    5. 움직이는 속도에 비례해서 요금기의 역할을 하는 카운터가 올라간다. 
        또한 빨간불의 상황일 때 신호대기를 하는 중에도 차량의 엔진은 공회전 하고 연료를 소모하므로 미터기가 올라가도록 한다.
    6. 후진을 하는 경우에도 차량의 엔진은 작동하며, 연료 소모를 한다. 
        따라서 후진의 경우에도 미터기가 올라가도록 한다. 
    7. 실제 토크 컨버터가 내장된 자동 변속기가 차량은 Creeping 현상이 있다. 
        이를 고려하고 브레이크를 밟지 않는 한 기본적으로 굴러가는 속도가 있도록 설계한다. 
    8. 택시 운행 후 요금을 계산한 후 미터기를 초기화하는 과정이 필요하다.
    9. 미터기 카운터 값은 999999까지 표현이 가능하다. 카운터 오버플로 처리과정이 필요하다.

요구사항을 구현하는 방법: 
    1. PWM에 들어가는 Duty 값에 입력을 연동하여 구현한다. (sw3: 감속, sw4: 가속)
    2. 아무 입력이 없을 때에도 Duty 값이 줄어들도록 한다. 
        (카운터 -= 로써 구현, 이 때 감속 스위치를 입력했을 때에는 값을 더해서 줄어들도록 한다.)
    3. sw3과 sw4 입력을 and 신호로 묶어서 이 때의 duty 변화를 따로 설정한다. 
    4. 노란불일 경우 현재 가지고 있는 Duty 값을 지정한 시간에 걸쳐 줄어들도록 한다. 
        이 때 Duty값이 750이든 900이든 1000이든 상관없이 지정한 시간동안 선형적으로 Deadzone인 (최저 하한선) 500으로 줄어들게 한다. 
    5. 현재 Duty의 값에 연동해서 올라가는 카운터 값이 변하도록 설정한다. 
        빨간불에 신호대기를 하는 상황에는 미리 지정한 카운터 값 만큼만 올라가도록 한다. 
    6. isMotorForward라는 함수를 구현하여 모터가 시계방향 (DC_IN 1), 반시계 방향을 (DC_IN 2) 자유자제로 전환하도록 구현한다. 
        이 때 반시계 방향으로 작동하는 경우에도 Duty의 값에 비례하여 카운터 값이 올라가도록 설정한다. 
    7. 차가 정상적으로 주행중인 상황일 (초록불) 때 아무런 입력을 하지 않으면 가장 최저 속도로 주행하도록 한다. (여기서는 Duty 값 600으로 설정) 
        이 때 감속 버튼을 누르면 duty는 줄어들고 계속 누르면 Duty가 허용 최저값인 500으로 떨어지게 한다.
    8. 목적지에 도착해서 요금기의 가격을 초기화 해야하는 경우를 위해 sw1은 카운터 값을 0으로 초기화 하도록 한다.
    9. 카운터 값은 1000000이 넘어가면 0으로 초기화 한다. 

참고: 
빨간불 -> 초록불 -> 노란불 -> 빨간불 -> 초록불 순서로 변한다
빨간불: 6초 
노란불: 3초 
초록불: 3초
duty 값 500 밑으로는 모터가 작동하지 않는다. 이를 데드존(Deadzone)이라 한다
